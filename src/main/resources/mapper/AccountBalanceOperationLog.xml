<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tianli.account.mapper.AccountBalanceOperationLogMapper">

    <select id="list" parameterType="com.tianli.management.query.WalletChargeFlowQuery"
            resultType="com.tianli.account.vo.WalletChargeFlowVo">
        SELECT
        abol.id,
        abol.uid,
        abol.coin,
        abol.charge_type,
        abol.order_no,
        abol.amount,
        abol.create_time,
        abol.balance,
        abol.freeze,
        abol.remain,
        abol.log_type,
        act.operation_type,
        act.operation_group,
        act.name as chargeTypeName
        FROM
        account_balance_operation_log abol
        inner join order_charge_type act ON abol.charge_type = act.type
        where
        <trim prefixOverrides="and">
            <if test="param.type != null ">
                and abol.charge_type = #{param.type}
            </if>
            <if test="param.operationGroup != null ">
                and act.operation_group = #{param.operationGroup}
            </if>

            <if test="param.accountOperationType != null and param.accountOperationType != ''">
                and abol.log_type = #{accountOperationType}
            </if>
            <if test="param.uid !=null and param.uid !=''">
                and abol.uid=#{param.uid}
            </if>
            <if test="param.coin !=null and param.coin !=''">
                and abol.coin=#{param.coin}
            </if>
            <if test="param.operationType !=null">
                and act.operation_type=#{param.operationType}
            </if>
            <if test="param.startTime != null">
                and abol.create_time &gt; #{param.startTime}
            </if>
            <if test="param.endTime != null">
                and abol.create_time &lt; #{param.endTime}
            </if>
        </trim>
        ORDER BY
        create_time DESC,
        id DESC
    </select>


    <select id="pageList" resultType="com.tianli.account.entity.AccountBalanceOperationLog">
        SELECT
        id,
        uid,
        account_balance_id,
        charge_type,
        log_type,
        coin,
        network,
        order_no,
        amount,
        create_time,
        balance,
        freeze,
        remain,
        des
        FROM
        account_balance_operation_log
        where uid=#{uid}
        <if test="(param.chargeType != null and param.chargeType.size() > 0) or (param.chargeTypeQueries != null and param.chargeTypeQueries.size() > 0)">
            and (

            <if test="param.chargeType != null and param.chargeType.size() > 0 ">
                charge_type in
                <foreach collection="param.chargeType" index="index" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>


            <if test="param.chargeTypeQueries != null and param.chargeTypeQueries.size() > 0 ">

                <if test="param.chargeType != null and param.chargeType.size() > 0 ">
                    or
                </if>

                <foreach collection="param.chargeTypeQueries" index="index" item="item" open="" separator=" or "
                         close="">
                    ( charge_type = #{item.chargeType} and log_type = #{item.accountOperationType})
                </foreach>
            </if>
            )
        </if>
        <if test="param.coin != null and param.coin != ''">
            and coin=#{param.coin}
        </if>

        <if test="param.startTime !=null">
            and create_time &gt; #{param.startTime}
        </if>

        <if test="param.endTime !=null">
            and create_time &lt; #{param.endTime}
        </if>
        ORDER BY
        create_time DESC,
        id DESC
    </select>


</mapper>
